# 管理后台批量功能说明

## 新增功能概述

在W3Cay管理后台新增了强大的批量操作功能，包括iframe检测、批量上线、批量下线等。

## 主要功能

### 1. 检测当前页
- **位置**：在搜索区域右侧
- **功能**：一键选择当前页面显示的所有网站
- **显示**：按钮显示当前页面网站数量，如"检测当前页 (20)"
- **使用**：点击后自动选择当前页所有网站，然后可以进行批量操作

### 2. 页面状态指示器
- **位置**：搜索区域下方
- **显示内容**：
  - 已展示网站数量（绿色）
  - 待审核网站数量（橙色）
  - 总计网站数量（蓝色）
- **格式**：当前页：已展示 15 | 待审核 5 | 总计 20

### 3. 批量操作区域
当选择网站后，页面顶部会显示批量操作区域，包含：

#### 选择控制
- **已选择数量**：显示当前选中的网站数量
- **快速选择**：
  - 选择已展示：快速选择所有已展示的网站
  - 选择待审核：快速选择所有待审核的网站
  - 取消选择：清空所有选择

#### 批量操作按钮
- **批量检测iframe**：检测选中网站的iframe嵌入状态，不允许的自动下线
- **批量上线**：将选中的网站全部上线（isShow = 1）
- **批量下线**：将选中的网站全部下线（isShow = 0）

### 4. 表格增强
- **复选框**：每行左侧新增复选框，支持单选
- **全选**：表头复选框支持全选/取消全选
- **悬停效果**：鼠标悬停时行背景变色
- **选择状态**：复选框显示当前选择状态

## 使用流程

### 方法一：检测当前页所有网站
1. 在搜索区域点击"检测当前页 (X)"按钮
2. 系统自动选择当前页所有网站
3. 点击"批量检测iframe"按钮
4. 等待检测完成，查看结果

### 方法二：选择性检测
1. 手动勾选要检测的网站（支持单选、全选）
2. 或使用快速选择功能：
   - 点击"选择已展示"选择所有已展示网站
   - 点击"选择待审核"选择所有待审核网站
3. 点击"批量检测iframe"按钮
4. 等待检测完成，查看结果

### 方法三：批量状态管理
1. 选择要操作的网站
2. 点击相应的批量操作按钮：
   - "批量上线"：将网站设为已展示状态
   - "批量下线"：将网站设为待审核状态
3. 等待操作完成，查看结果

## 技术特性

### 1. 无确认操作
- 所有批量操作按钮点击后直接执行，无需二次确认
- 提高操作效率，适合频繁使用

### 2. 实时反馈
- 操作过程中按钮显示加载状态
- 操作完成后显示详细结果
- 自动刷新列表显示最新状态

### 3. 错误处理
- 网络错误时显示友好提示
- 操作失败时保留选择状态
- 支持重试操作

### 4. 状态同步
- 操作完成后自动刷新列表
- 清空选择状态，避免误操作
- 保持当前页面和筛选条件

## 性能优化

### 1. 并发处理
- 批量上线/下线使用Promise.all并发执行
- 批量检测使用API批量处理
- 减少网络请求次数

### 2. 状态管理
- 使用React hooks管理选择状态
- 避免不必要的重新渲染
- 优化用户交互体验

### 3. 内存管理
- 操作完成后自动清理选择状态
- 避免内存泄漏
- 保持界面响应性

## 文件结构

```
src/app/admin/
└── page.js                    # 管理后台主页面（已更新）

src/app/api/admin/
├── check-iframe/
│   └── route.js              # 单个检测API
└── check-iframe-bulk/
    └── route.js              # 批量检测API
```

## 注意事项

1. **权限要求**：需要管理员权限才能使用批量功能
2. **网络依赖**：iframe检测需要访问目标网站
3. **操作不可逆**：批量下线操作会立即生效，请谨慎操作
4. **性能考虑**：大量网站批量操作可能需要较长时间
5. **浏览器兼容**：建议使用现代浏览器以获得最佳体验 