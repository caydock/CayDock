{{ define "main" }}
  {{ $partial := print "home/" .Site.Params.homepage.layout ".html" }}
  {{ if templates.Exists ( printf "partials/%s" $partial ) }}
    {{ partial $partial . }}
  {{ else }}
    {{ partial "home/profile.html" . }}
  {{ end }}
  
  {{/* 最新博客文章 */}}
  {{ $postsSection := .Site.GetPage "/posts" }}
  {{ if $postsSection }}
    {{ $latestPosts := $postsSection.RegularPages | first 3 }}
    {{ if $latestPosts }}
    <section class="mt-20">
      <header class="mb-8">
        <h2 class="mt-5 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
          {{ if eq .Site.Language.Lang "zh-cn" }}最新文章{{ else }}Latest Posts{{ end }}
        </h2>
        <p class="mt-1 mb-2 text-base text-neutral-500 dark:text-neutral-400">
          {{ if eq .Site.Language.Lang "zh-cn" }}最近发布的博客文章{{ else }}Recently published blog posts{{ end }}
        </p>
      </header>
      
      <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
        {{ range $latestPosts }}
          {{ partial "article-link/card.html" . }}
        {{ end }}
      </section>
      
      <div class="text-center mt-8">
        <a href="{{ $postsSection.RelPermalink }}" class="inline-block px-6 py-3 text-base font-semibold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors">
          {{ if eq .Site.Language.Lang "zh-cn" }}查看所有文章 →{{ else }}View All Posts →{{ end }}
        </a>
      </div>
    </section>
    {{ end }}
  {{ end }}
  
  {{ $products := index .Site.Data (printf "products.%s" .Site.Language.Lang) }}
  {{ if not $products }}
    {{ $products = .Site.Data.products }}
  {{ end }}
  {{ if $products }}
  <section class="mt-20">
    <header class="mb-8">
      <h2 class="mt-5 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        {{ $products.title }}
      </h2>
      <p class="mt-1 mb-2 text-base text-neutral-500 dark:text-neutral-400">
        {{ $products.subtitle }}
      </p>
    </header>
    
    <div class="products-grid-home">
      {{ range $products.items }}
      <a href="{{ .link }}" {{ if hasPrefix .link "http" }}target="_blank"{{ end }} class="product-card-home">
        <div class="product-content-home">
          <div class="product-header-home">
            <img src="{{ .icon }}" alt="{{ .title }} icon" class="product-icon-home" 
                 onerror="this.onerror=null; this.src='{{ .link }}/favicon.ico'; this.onerror=function(){this.style.display='none'}">
            <h3 class="product-title-home">{{ .title }}</h3>
          </div>
          <p class="product-description-home">{{ .description }}</p>
          <p class="product-link-home">{{ .link }}</p>
        </div>
      </a>
      {{ end }}
    </div>
  </section>
  {{ end }}
{{ end }}
